<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="2025-05-14-07-test-tasks" author="claude">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="TASK"/>
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM PROJECT WHERE ID IN (1,2)
            </sqlCheck>
            <sqlCheck expectedResult="7">
                SELECT COUNT(*) FROM SPRINT WHERE ID IN (1,5)
            </sqlCheck>
        </preConditions>

        <comment>Добавление тестовых задач для спринтов</comment>

        <!-- Вставка задач -->
        <sql>
            INSERT INTO TASK (TITLE, TYPE_CODE, STATUS_CODE, PROJECT_ID, SPRINT_ID, STARTPOINT)
            VALUES
                ('Data', 'epic', 'in_progress', 1, 1, '2023-05-15 09:05:10'),
                ('Trees', 'epic', 'in_progress', 1, 1, '2023-05-15 12:05:10'),
                ('task-3', 'task', 'ready_for_test', 2, 5, '2023-06-14 09:28:10'),
                ('task-4', 'task', 'ready_for_review', 2, 5, '2023-06-14 09:28:10'),
                ('task-5', 'task', 'todo', 2, 5, '2023-06-14 09:28:10'),
                ('task-6', 'task', 'done', 2, 5, '2023-06-14 09:28:10'),
                ('task-7', 'task', 'canceled', 2, 5, '2023-06-14 09:28:10');
        </sql>

        <!-- Обновление последовательности для H2 -->
        <sql dbms="h2">
            ALTER TABLE TASK ALTER COLUMN ID RESTART WITH (SELECT MAX(ID) + 1 FROM TASK);
        </sql>
    </changeSet>
</databaseChangeLog>